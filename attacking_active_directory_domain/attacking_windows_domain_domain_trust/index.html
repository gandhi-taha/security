<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="gandhi-taha">
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Attacking Domain Trust - Notes</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "What is domain trust?", url: "#_top", children: [
              {title: "Types of trust", url: "#types-of-trust" },
              {title: "Transitive trust.", url: "#transitive-trust" },
              {title: "Directional trust", url: "#directional-trust" },
          ]},
          {title: "Attack Strategy", url: "#attack-strategy", children: [
              {title: "Map the domain trusts", url: "#map-the-domain-trusts" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../domain_privilege_escalation_checklist/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../domain_privilege_escalation_checklist/" class="btn btn-xs btn-link">
        Domain Privilege Escalation Checklist
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../active_directory_privilege_escalation/passwords_in_group_policy_preferences/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../active_directory_privilege_escalation/passwords_in_group_policy_preferences/" class="btn btn-xs btn-link">
        Password in GPO
      </a>
    </div>
    
  </div>

    

    <h2 id="what-is-domain-trust">What is domain trust?<a class="headerlink" href="#what-is-domain-trust" title="Permanent link">#</a></h2>
<p>Domain trust is a concept used to establish trust between domains. If there is trust between two domains users can access resources in the other domain.</p>
<p><code>Domain forest</code> is a group of domains that trust each other. Forests maybe also have trust between them.</p>
<h3 id="types-of-trust">Types of trust<a class="headerlink" href="#types-of-trust" title="Permanent link">#</a></h3>
<ul>
<li>Parent/Child</li>
</ul>
<p>Part of the same forest. Retains an implicit two-way transitive trust.</p>
<p>I think this might be stuff like child: test.mydomain.local, and parent mydomain.local.</p>
<ul>
<li>Crosslink</li>
</ul>
<h3 id="transitive-trust">Transitive trust.<a class="headerlink" href="#transitive-trust" title="Permanent link">#</a></h3>
<p>If Domain A trusts Domain B, and Domain B trust domain C, then Domain A trusts Domain C.
So you can have trust-chains.</p>
<h3 id="directional-trust">Directional trust<a class="headerlink" href="#directional-trust" title="Permanent link">#</a></h3>
<p>You can have One way trust and bidirectional trust. A bidirectional trust is simply two one-way trusts.</p>
<p>If A is trusted by B. That means that A can access resources in B. Think of it like this: If A is trusted by B, then B will let A into his house.</p>
<h2 id="attack-strategy">Attack Strategy<a class="headerlink" href="#attack-strategy" title="Permanent link">#</a></h2>
<p>As always the first part of an attack is enumeration. We need to know the following:
1. Which domains have trusts with each other
Essentially create a map of trusts between domains.</p>
<ol>
<li>
<p>Enumerate any user/group/computer (security principals) that in one domain that has access to resources in another domain. For example, member in local Admin group.
What we want to do is look for some kind of bridge between the two domains. That is usually the case, because a trust relationship is usually implemented because resources need to be shared over the domain bounderies.
It might be possible with kerberoasting over boundries.</p>
</li>
<li>
<p>Exploit the identified targets</p>
</li>
</ol>
<h3 id="map-the-domain-trusts">Map the domain trusts<a class="headerlink" href="#map-the-domain-trusts" title="Permanent link">#</a></h3>
<p>This can be done using three techniques: Win32 API Calls, various .NET methods, and LDAP queries.</p>
<p>With PowerShell this can be done with the following code:</p>
<pre><code>([System.DirectoryServices.ActiveDirectory.Forest]::GetCurrentForest()).GetAllTrustRelationships()
([System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()).GetAllTrustRelationships()
</code></pre>

<p>The functionality is also included in PowerView, and can be run like this:</p>
<pre><code>Get-DomainTrust
Get-ForestTrust
</code></pre>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../domain_privilege_escalation_checklist/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../domain_privilege_escalation_checklist/" class="btn btn-xs btn-link">
        Domain Privilege Escalation Checklist
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../active_directory_privilege_escalation/passwords_in_group_policy_preferences/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../active_directory_privilege_escalation/passwords_in_group_policy_preferences/" class="btn btn-xs btn-link">
        Password in GPO
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
      <p>
        <a href="https://github.com/gandhi-taha/edit/master/docs/attacking_active_directory_domain/attacking_windows_domain_domain_trust.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>